##### LLM INPUT #####
================================ System Message ================================

You are a developer. Your task is to install dependencies and set up a environment that is able to run the tests of the project.

- You start with an initial Docker container based on ubuntu:22.04.
- You interact with a Bash session inside this container.
- Project files are located in /testbed within the container, and your current working directory of bash is already set to /testbed.
- No need to clone the project again.

The final objective is to successfully run the tests of the project.


### C-Specific Instructions:
- Install build-essential if not available: `apt-get update && apt-get install -y build-essential`
- Use `make` to build the project (check for Makefile)
- Use `gcc` or `clang` directly if no Makefile exists
- Check for CMakeLists.txt and use `cmake` if available
- Install dependencies through package manager (apt, yum, etc.)
- Look for configure scripts and run `./configure && make`


================================ Human Message =================================


You run in a loop of Thought, Action, Observation.
At the end of the loop you should use Action to stop the loop.

Use Thought to describe your thoughts about the question you have been asked.
Use Action to run one of the actions available to you.
Observation will be the result of running those actions.
> Important Note: Each step, reply with only **one** (Thought, Action) pair.
> Important Note: Do not reply **Observation**, it will be provided by the system.

Your available actions are:

    Command: run a command in the bash, reply with following format, your command should not require sudo or interactive input:
        <command>bash command</command>
        e.g. install build-essential: <command>apt-get install -y build-essential</command>
        e.g. view file content: <command>cat README.md</command>
    Search: search the web for if you need some information, generate query and reply with following format:
        <search>the search query</search>
        e.g. <search>how to fix 'No module named setuptools'</search>
        e.g. <search>how to install python3 on ubuntu</search>
        e.g. <search>how to create development environment for python3</search>
    Stop: stop the setup loop once you think the setup is complete, reply with following format:
        <stop></stop>
    

Observation will be the result of running those actions.


Project Structure: the structure of the project, including files and directories.
Related Files: the content of related files of the project that may help you understand the project.
Thought: you should always think about what to do
Action: <command>your bash command here</command> or <search>your search query</search> or other actions available
Observation: the result of the action
... (this Thought/Action/Observation can repeat N times) ...
Thought: I think the setup should be fine
Action: <stop>stop the setup</stop>
Answer: the final result

Begin!
Project Structure: 📂 
/home/hagon/Project/msb/EnvAgent/git/EnvBench/baseline_RepoLaunch/SWE-bench-Live/launch/
playground/test/libsdl-org__SDL-11946/repo
┣━━ 📂 .github
┣━━ 📂 android-project
┣━━ 📂 build-scripts
┣━━ 📂 cmake
┣━━ 📂 docs
┣━━ 📂 examples
┣━━ 📂 include
┣━━ 📂 src
┣━━ 📂 test
┣━━ 📂 VisualC
┣━━ 📂 VisualC-GDK
┣━━ 📂 wayland-protocols
┣━━ 📂 Xcode
┣━━ 📄 .clang-format
┣━━ 📄 .clang-tidy
┣━━ 📄 .editorconfig
┣━━ 📄 .wikiheaders-options
┣━━ 📄 Android.mk
┣━━ 📄 BUGS.txt
┣━━ 📄 CMakeLists.txt
┣━━ 📄 CREDITS.md
┣━━ 📄 INSTALL.md
┣━━ 📄 LICENSE.txt
┣━━ 📄 README.md
┗━━ 📄 WhatsNew.txt

Related Files: ------ BEGIN RELATED FILES ------
File: docs/README-visualc.md
```
Using SDL with Microsoft Visual C++
===================================

#### by Lion Kimbro with additions by James Turk

You can either use the precompiled libraries from the [SDL](https://www.libsdl.org/download.php) web site, or you can build SDL
yourself.

### Building SDL

0. To build SDL, your machine must, at a minimum, have the DirectX9.0c SDK installed. It may or may not be retrievable from
the [Microsoft](https://www.microsoft.com) website, so you might need to locate it [online](https://duckduckgo.com/?q=directx9.0c+sdk+download&t=h_&ia=web).
_Editor's note: I've been able to successfully build SDL using Visual Studio 2019 **without** the DX9.0c SDK_

1. Open the Visual Studio solution file at `./VisualC/SDL.sln`.

2. Your IDE will likely prompt you to upgrade this solution file to whatever later version of the IDE you're using. In the `Retarget Projects` dialog,
all of the affected project files should be checked allowing you to use the latest `Windows SDK Version` you have installed, along with
the `Platform Toolset`.

If you choose *NOT* to upgrade to use the latest `Windows SDK Version` or `Platform Toolset`, then you'll need the `Visual Studio 2010 Platform Toolset`.

3. Build the `.dll` and `.lib` files by right clicking on each project in turn (Projects are listed in the _Workspace_
panel in the _FileView_ tab), and selecting `Build`.

You may get a few warnings, but you should not get any errors.

Later, we will refer to the following `.lib` and `.dll` files that have just been generated:

-   `./VisualC/Win32/Debug/SDL3.dll` or `./VisualC/Win32/Release/SDL3.dll`
-   `./VisualC/Win32/Debug/SDL3.lib` or `./VisualC/Win32/Release/SDL3.lib`

_Note for the `x64` versions, just replace `Win32` in the path with `x64`_

### Creating a Project with SDL

- Create a project as a `Win32 Application`.

- Create a C++ file for your project.

- Set the C runtime to `Multi-threaded DLL` in the menu:
  `Project|Settings|C/C++ tab|Code Generation|Runtime Library `.

- Add the SDL `include` directory to your list of includes in the menu:
  `Project|Settings|C/C++ tab|Preprocessor|Additional include directories `

*VC7 Specific: Instead of doing this, I find it easier to add the
include and library directories to the list that VC7 keeps. Do this by
selecting Tools|Options|Projects|VC++ Directories and under the "Show
Directories For:" dropbox select "Include Files", and click the "New
Directory Icon" and add the [SDLROOT]\\include directory (e.g. If you
installed to c:\\SDL\\ add c:\\SDL\\include). Proceed to change the
dropbox selection to "Library Files" and add [SDLROOT]\\lib.*

The "include directory" I am referring to is the `./include` folder.

Now we're going to use the files that we had created earlier in the *Build SDL* step.

Copy the following file into your Project directory:

-   `SDL3.dll`

Add the following file to your project (It is not necessary to copy it to your project directory):

-   `SDL3.lib`

To add them to your project, right click on your project, and select
`Add files to project`.

**Instead of adding the files to your project, it is more desirable to add them to the linker options: Project|Properties|Linker|Command Line
and type the names of the libraries to link with in the "Additional Options:" box. Note: This must be done for each build configuration
(e.g. Release,Debug).**

### Hello SDL

Here's a sample SDL snippet to verify everything is setup in your IDE:

```c
#include <SDL3/SDL.h>
#include <SDL3/SDL_main.h> // only include this one in the source file with main()!

int main( int argc, char* argv[] )
{
	const int WIDTH = 640;
	const int HEIGHT = 480;
	SDL_Window* window = NULL;
	SDL_Renderer* renderer = NULL;

	SDL_Init(SDL_INIT_VIDEO);
	window = SDL_CreateWindow("Hello SDL", WIDTH, HEIGHT, 0);
	renderer = SDL_CreateRenderer(window, NULL);

	SDL_DestroyRenderer(renderer);
	SDL_DestroyWindow(window);
	SDL_Quit();
	return 0;
}
```

### That's it!

I hope that this document has helped you get through the most difficult part of using the SDL: installing it.
Suggestions for improvements should be posted to the [Github Issues](https://github.com/libsdl-org/SDL/issues).

### Credits

Thanks to [Paulus Esterhazy](mailto:pesterhazy@gmx.net), for the work on VC++ port.

This document was originally called "VisualC.txt", and was written by [Sam Lantinga](mailto:slouken@libsdl.org).

Later, it was converted to HTML and expanded into the document that you see today by [Lion Kimbro](mailto:snowlion@sprynet.com).

Minor Fixes and Visual C++ 7 Information (in italic) was added by [James Turk](mailto:james@conceptofzero.net)

```
File: .github/workflows/generic.yml
```
name: 'Build'
run-name: 'Configure, Build and Test SDL'

on:
  workflow_call:
    inputs:
      platforms:
        description: 'JSON-encoded test properties'
        type: string
        required: true

jobs:
  build:
    name: ${{ matrix.platform.name }}
    runs-on: ${{ matrix.platform.os }}
    container: ${{ matrix.platform.container }}
    defaults:
      run:
        shell: ${{ matrix.platform.shell }}
    strategy:
      fail-fast: false
      matrix:
        platform: ${{ fromJSON(inputs.platforms) }}
    steps:
      - name: 'Set up MSYS2'
        if: ${{ matrix.platform.platform == 'msys2' }}
        uses: msys2/setup-msys2@v2
        with:
          msystem: ${{ matrix.platform.msys2-msystem }}
          install: >-
            ${{ matrix.platform.msys2-env }}-cc
            ${{ matrix.platform.msys2-env }}-cmake
            ${{ matrix.platform.msys2-env }}-ninja
            ${{ (!matrix.platform.msys2-no-perl && format('{0}-perl', matrix.platform.msys2-env)) || '' }}
            ${{ matrix.platform.msys2-env }}-pkg-config
            ${{ matrix.platform.msys2-env }}-clang-tools-extra
      - name: 'About this job'
        run: |
          echo "key=${{ matrix.platform.key }}"
          echo "name=${{ matrix.platform.name }}"
          echo "os=${{ matrix.platform.os }}"
          echo ""
          echo "Add [sdl-ci-filter ${{ matrix.platform.key }}] to your commit message to reduce the number of jobs."
      - uses: actions/checkout@v4
      - name: 'Set up ninja'
        if: ${{ matrix.platform.setup-ninja }}
        uses: ./.github/actions/setup-ninja
      - name: 'Set up libusb for MSVC'
        if: ${{ matrix.platform.setup-libusb-arch != '' }}
        uses: ./.github/actions/setup-msvc-libusb
        with:
          arch: ${{ matrix.platform.setup-libusb-arch }}
      - uses: mymindstorm/setup-emsdk@v14
        if: ${{ matrix.platform.platform == 'emscripten' }}
        with:
          version: 3.1.35
      - uses: browser-actions/setup-chrome@v1
        id: setup-chrome
        if: ${{ matrix.platform.platform == 'emscripten' }}
        with:
          install-chromedriver: true
      - name: 'Add chrome to PATH'
        if: ${{ matrix.platform.platform == 'emscripten' }}
        run: |
          chrome_dir="$(dirname "${{ steps.setup-chrome.outputs.chrome-path }}")"
          chromedriver_dir="$(dirname "${{ steps.setup-chrome.outputs.chromedriver-path }}")"
          echo "CHROME_BINARY=${{ steps.setup-chrome.outputs.chrome-path }}" >>$GITHUB_ENV
          echo "CHROMEDRIVER_BINARY=${{ steps.setup-chrome.outputs.chromedriver-path }}" >>$GITHUB_ENV
          echo "chrome_dir=${chrome_dir}"
          echo "chromedriver_dir=${chromedriver_dir}"
          echo "${chrome_dir}" >>${GITHUB_PATH}
          echo "${chromedriver_dir}" >>${GITHUB_PATH}
      - uses: nttld/setup-ndk@v1
        if: ${{ matrix.platform.android-ndk }}
        id: setup-ndk
        with:
          local-cache: true
          ndk-version: r21e
      - name: 'Configure Android NDK variables'
        if: ${{ matrix.platform.android-ndk }}
        shell: sh
        run: |
          # We cannot use GitHub expressions in the controller job
          echo "ANDROID_NDK_HOME=${{ steps.setup-ndk.outputs.ndk-path }}" >>$GITHUB_ENV
      - uses: actions/setup-java@v4
        if: ${{ matrix.platform.java }}
        with:
          distribution: 'temurin'
          java-version: '17'
      - uses: ilammy/msvc-dev-cmd@v1
        if: ${{ matrix.platform.platform == 'msvc' }}
        with:
          arch: ${{ matrix.platform.msvc-vcvars-arch }}
          sdk: ${{ matrix.platform.msvc-vcvars-sdk }}
      - name: 'Set up Windows GDK Desktop'
        uses: ./.github/actions/setup-gdk-desktop
        if: ${{ matrix.platform.setup-gdk-folder != '' }}
        with:
          folder: '${{ matrix.platform.setup-gdk-folder }}'
      - name: 'Set up LoongArch64 toolchain'
        uses: ./.github/actions/setup-loongarch64-toolchain
        id: setup-loongarch64-toolchain
        if: ${{ matrix.platform.platform == 'loongarch64' }}
      - name: 'Setup Intel oneAPI toolchain'
        id: intel
        if: ${{ matrix.platform.intel }}
        run: |
          # Download the key to system keyring
          wget -O- https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB \
            | gpg --dearmor | sudo tee /usr/share/keyrings/oneapi-archive-keyring.gpg > /dev/null
          
          # Add signed entry to apt sources and configure the APT client to use Intel repository:
          echo "deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main" | sudo tee /etc/apt/sources.list.d/oneAPI.list
          
          # Update package list
          sudo apt-get update -y
          
          # Install oneAPI
          sudo apt-get install -y intel-oneapi-compiler-dpcpp-cpp-and-cpp-classic
      - name: 'Install apk packages'
        if: ${{ matrix.platform.apk-packages != '' }}
        run: |
          ${{ matrix.platform.sudo }} apk update
          ${{ matrix.platform.sudo }} apk add ${{ matrix.platform.apk-packages }}
      - name: 'Install apt packages'
        if: ${{ matrix.platform.apt-packages != '' }}
        run: |
          ${{ matrix.platform.sudo }} apt-get update
          ${{ matrix.platform.sudo }} apt-get install -y ${{ matrix.platform.apt-packages }}
      - name: 'Install brew packages'
        if: ${{ matrix.platform.brew-packages != '' }}
        run: |
          export HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1
          brew update
          brew install ${{ matrix.platform.brew-packages }}
      - name: 'Set up GLES for VITA'  # Must be after apk
        if: ${{ matrix.platform.setup-vita-gles-type != '' }}
        uses: ./.github/actions/setup-vita-gles
        with:
          type: ${{ matrix.platform.setup-vita-gles-type }}

      - name: 'Pollute toolchain with "bad" SDL headers'
        if: ${{ matrix.platform.pollute-directories != '' }}
        #shell: ${{ matrix.platform.shell }}
        run: |
          # Create "bad" SDL headers in the toolchain.
          # SDL sources should not use these.
          for include in ${{ matrix.platform.pollute-directories }}; do
            toolchain_directory="${include}/SDL3"
            echo "Creating directory ${toolchain_directory}"
            mkdir -p "${toolchain_directory}/SDL3"
            for header in include/SDL3/*.h; do
              dest="${toolchain_directory}/SDL3/$(basename "${header}")"
              echo "Creating ${dest}"
              echo '#error "System SDL headers must not be used by build system"' >"$dest"
            done
          done

      - name: 'Configure (CMake)'
        if: ${{ !matrix.platform.no-cmake }}
        #shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          ${{ matrix.platform.cmake-config-emulator }} cmake -S . -B build -GNinja \
            -Wdeprecated -Wdev -Werror \
            ${{ matrix.platform.cmake-toolchain-file != '' && format('-DCMAKE_TOOLCHAIN_FILE={0}', matrix.platform.cmake-toolchain-file) || '' }} \
            -DSDL_WERROR=${{ matrix.platform.werror }} \
            -DSDL_EXAMPLES=${{ matrix.platform.build-tests }} \
            -DSDL_TESTS=${{ matrix.platform.build-tests }} \
            -DSDLTEST_TRACKMEM=ON \
            -DSDL_INSTALL_TESTS=${{ matrix.platform.build-tests }} \
            -DSDL_CLANG_TIDY=${{ matrix.platform.clang-tidy }} \
            -DSDL_INSTALL_DOCS=ON \
            -DSDL_INSTALL_CPACK=ON \
            -DSDL_INSTALL_DOCS=ON \
            ${{ matrix.platform.cmake-arguments }} \
            -DSDL_SHARED=${{ matrix.platform.shared }} \
            -DSDL_STATIC=${{ matrix.platform.static  }} \
            -DSDL_VENDOR_INFO="Github Workflow" \
            -DCMAKE_INSTALL_PREFIX=prefix \
            -DCMAKE_INSTALL_LIBDIR=lib \
            -DCMAKE_BUILD_TYPE=${{ matrix.platform.cmake-build-type }}
      - name: 'Build (CMake)'
        id: build
        if: ${{ !matrix.platform.no-cmake }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          cmake --build build --config ${{ matrix.platform.cmake-build-type }} --verbose -- ${{ matrix.platform.cmake-build-arguments }}
      - name: 'Verify SDL_REVISION'
        if: ${{ !matrix.platform.no-cmake }}
        run: |
          echo "This should show us the SDL_REVISION"
          echo "Shared library:"
          ${{ (matrix.platform.shared-lib && format('strings build/{0} | grep "Github Workflow"', matrix.platform.shared-lib)) || 'echo "<Shared library not supported by platform>"' }}
          echo "Static library:"
          ${{ (matrix.platform.static-lib && format('strings build/{0} | grep "Github Workflow"', matrix.platform.static-lib)) || 'echo "<Static library not supported by platform>"' }}
      - name: 'Run build-time tests (CMake)'
        id: tests
        if: ${{ !matrix.platform.no-cmake && matrix.platform.run-tests }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          ${{ matrix.platform.pretest-cmd }}
          set -eu
          export SDL_TESTS_QUICK=1
          ctest -VV --test-dir build/ -j2
      - name: "Build test apk's (CMake)"
        id: apks
        if: ${{ always() && steps.build.outcome == 'success' && matrix.platform.android-apks != '' }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          cmake --build build --config ${{ matrix.platform.cmake-build-type }} \
            --target \
              ${{ matrix.platform.android-apks }} \
            --verbose \
            -- ${{ matrix.platform.cmake-build-arguments }}
      - name: 'Install (CMake)'
        id: install
        if: ${{ always() && steps.build.outcome == 'success' }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          cmake --install build --config ${{ matrix.platform.cmake-build-type }}
          echo "prefix=$(pwd)/prefix" >> $GITHUB_OUTPUT
          ( cd prefix; find . ) | LC_ALL=C sort -u
      - name: 'Package (CPack)'
        id: package
        if: ${{ always() && steps.build.outcome == 'success' }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          # DMG creation on macOS occasionally fails, so try multiple times
          # https://gitlab.kitware.com/cmake/cmake/-/issues/25671
          success=0
          max_tries=10
          for i in $(seq $max_tries); do
           cmake --build build/ --config ${{ matrix.platform.cmake-build-type }} --target package -- ${{ matrix.platform.cmake-build-arguments }} && success=1
           if test $success = 1; then
            break
           fi
           echo "Package creation failed. Sleep 1 second and try again."
           sleep 1
          done
          if test $success = 0; then
           echo "Package creation failed after $max_tries attempts."
           exit 1
          fi
      - name: 'Verify CMake configuration files'
        if: ${{ steps.install.outcome == 'success' }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          ${{ matrix.platform.source-cmd }}
          ${{ matrix.platform.cmake-config-emulator }} cmake -S cmake/test -B cmake_test_build -GNinja \
            ${{ matrix.platform.cmake-toolchain-file != '' && format('-DCMAKE_TOOLCHAIN_FILE={0}', matrix.platform.cmake-toolchain-file) || '' }} \
            -DTEST_SHARED=${{ matrix.platform.shared }} \
            -DTEST_STATIC=${{ matrix.platform.static }} \
            ${{ matrix.platform.cmake-arguments }} \
            -DCMAKE_BUILD_TYPE=${{ matrix.platform.cmake-build-type }} \
            -DCMAKE_PREFIX_PATH="${{ steps.install.outputs.prefix }}"
          cmake --build cmake_test_build --verbose --config ${{ matrix.platform.cmake-build-type }} -- ${{ matrix.platform.cmake-build-arguments }}
      - name: 'Extract CC/CXX/CFLAGS/CXXFLAGS from CMake toolchain'
        if: ${{ steps.install.outcome == 'success' && matrix.platform.cc-from-cmake }}
#        shell: ${{ matrix.platform.shell }}
        run: |
          cmake -S .github/cmake -B /tmp/cmake_extract \
            ${{ matrix.platform.cmake-toolchain-file != '' && format('-DCMAKE_TOOLCHAIN_FILE={0}', matrix.platform.cmake-toolchain-file) || '' }} \
            -DCMAKE_BUILD_TYPE=${{ matrix.platform.cmake-build-type }} \
            -DVAR_PATH=/tmp/env.txt
          cat /tmp/env.txt >> $GITHUB_ENV
      - name: 'Verify sdl3.pc'
#        shell: ${{ matrix.platform.shell }}
        if: ${{ steps.install.outcome == 'success' && matrix.platform.test-pkg-config }}
        run: |
          ${{ matrix.platform.source-cmd }}
          ${{ matrix.platform.cc && format('export CC="{0}"', matrix.platform.cc) || '' }}
          ${{ matrix.platform.cflags && format('export CFLAGS="{0}"', matrix.platform.cflags) || '' }}
          ${{ matrix.platform.ldflags && format('export LDFLAGS="{0}"', matrix.platform.ldflags) || '' }}
          export PKG_CONFIG_PATH=${{ steps.install.outputs.prefix }}/lib/pkgconfig
          cmake/test/test_pkgconfig.sh
      - name: 'Build (cross-platform-actions, BSD)'
        id: cpactions
        if: ${{ matrix.platform.cpactions }}
        uses: cross-platform-actions/action@v0.26.0
        with:
          operating_system: '${{ matrix.platform.cpactions-os }}'
          architecture: '${{ matrix.platform.cpactions-arch }}'
          version: '${{ matrix.platform.cpactions-version }}'
          run: |
            ${{ matrix.platform.cpactions-setup-cmd }}
            ${{ matrix.platform.cpactions-install-cmd }}
            cmake -S . -B build -GNinja  \
              ${{ matrix.platform.cmake-toolchain-file != '' && format('-DCMAKE_TOOLCHAIN_FILE={0}', matrix.platform.cmake-toolchain-file) || '' }} \
              -Wdeprecated -Wdev -Werror \
              -DSDL_WERROR=${{ matrix.platform.werror }} \
              -DSDL_INSTALL_DOCS=ON \
              ${{ matrix.platform.cmake-arguments }} \
              -DSDL_SHARED=${{ matrix.platform.shared }} \
              -DSDL_STATIC=${{ matrix.platform.static  }} \
              -DSDL_VENDOR_INFO="Github Workflow" \
              -DCMAKE_INSTALL_PREFIX=prefix \
              -DCMAKE_INSTALL_LIBDIR=lib \
              -DCMAKE_BUILD_TYPE=${{ matrix.platform.cmake-build-type }}
            cmake --build build/ --config ${{ matrix.platform.cmake-build-type }} --verbose
            cmake --build build/ --config ${{ matrix.platform.cmake-build-type }} --target package

            cmake --build build/ --config ${{ matrix.platform.cmake-build-type }} --target clean
            rm -rf build/dist/_CPack_Packages
            rm -rf build/CMakeFiles
            rm -rf build/docs
      - name: Add msbuild to PATH
        id: setup-msbuild
        if: ${{ matrix.platform.msvc-project != '' }}
        uses: microsoft/setup-msbuild@v2
      - name: Build msbuild
        if: ${{ matrix.platform.msvc-project != '' }}
        run: |
          "$(cygpath -u '${{ steps.setup-msbuild.outputs.msbuildPath }}\msbuild.exe')" ${{ matrix.platform.msvc-project }} -m -p:BuildInParallel=true -p:Configuration=Release ${{ matrix.platform.msvc-project-flags }}
      - name: 'Build (Android.mk)'
        if: ${{ matrix.platform.android-mk }}
        run: |
          ./build-scripts/androidbuildlibs.sh
      - name: 'Create Gradle project (Android)'
        if: ${{ matrix.platform.android-gradle }}
        run: |
          for folder in build-ndk-build build-cmake; do
            python build-scripts/create-android-project.py \
              --output "${folder}" \
              --variant copy \
              org.libsdl.testspriteminimal \
              test/testspriteminimal.c test/icon.h
          done
          echo ""
          echo "Project contents:"
          echo ""
          find "build-ndk-build/org.libsdl.testspriteminimal"
      - name: 'Build Android app (Gradle & ndk-build)'
        if: ${{ matrix.platform.android-gradle }}
        run: |
          cd build-ndk-build/org.libsdl.testspriteminimal
          ./gradlew -i assembleRelease
      - name: 'Build Android app (Gradle & CMake)'
        if: ${{ matrix.platform.android-gradle }}
        run: |
          cd build-cmake/org.libsdl.testspriteminimal
          ./gradlew -i assembleRelease -PBUILD_WITH_CMAKE=1
      - name: 'Build (xcode)'
        if: ${{ matrix.platform.xcode-sdk != '' }}
        run: |
          xcodebuild -project Xcode/SDL/SDL.xcodeproj -target SDL3 -configuration Release -sdk ${{ matrix.platform.xcode-sdk }} clean build
      - name: 'Setup Python'
        uses: 'actions/setup-python@main'
        if: ${{ matrix.platform.check-sources }}
        with:
          python-version: '3.x'
      - name: 'Check Sources'
        if: ${{ matrix.platform.check-sources }}
        run: |
          set -e
          build-scripts/test-versioning.sh
          python build-scripts/check_android_jni.py
          python build-scripts/check_stdlib_usage.py
      - name: 'Upload binary package'
        uses: actions/upload-artifact@v4
        if: ${{ always() && matrix.platform.artifact != '' && (steps.package.outcome == 'success' || steps.cpactions.outcome == 'success') && (matrix.platform.enable-artifacts || steps.tests.outcome == 'failure') }}
        with:
          if-no-files-found: error
          name: '${{ matrix.platform.artifact }}'
          path: |
            build/dist/SDL3*
            build/include*
      - name: 'Upload minidumps'
        uses: actions/upload-artifact@v4
        if: ${{ always() && steps.tests.outcome == 'failure' && (matrix.platform.platform == 'msvc' || matrix.platform.platform == 'msys2') }}
        with:
          if-no-files-found: ignore
          name: '${{ matrix.platform.artifact }}-minidumps'
          path: build/**/*.dmp
      - name: "Upload Android test apk's"
        uses: actions/upload-artifact@v4
        if: ${{ matrix.platform.enable-artifacts && always() && matrix.platform.artifact != '' && steps.apks.outcome == 'success' }}
        with:
          if-no-files-found: error
          name: '${{ matrix.platform.artifact }}-apks'
          path: build/test/*.apk
```
File: docs/README-emscripten.md
```
# Emscripten

## The state of things

(As of October 2024, but things move quickly and we don't update this
document often.)

In modern times, all the browsers you probably care about (Chrome, Firefox,
Edge, and Safari, on Windows, macOS, Linux, iOS and Android), support some
reasonable base configurations:

- WebAssembly (don't bother with asm.js any more)
- WebGL (which will look like OpenGL ES 2 or 3 to your app).
- Threads (see caveats, though!)
- Game controllers
- Autoupdating (so you can assume they have a recent version of the browser)

All this to say we're at the point where you don't have to make a lot of
concessions to get even a fairly complex SDL-based game up and running.


## RTFM

This document is a quick rundown of some high-level details. The
documentation at [emscripten.org](https://emscripten.org/) is vast
and extremely detailed for a wide variety of topics, and you should at
least skim through it at some point.


## Porting your app to Emscripten

Many many things just need some simple adjustments and they'll compile
like any other C/C++ code, as long as SDL was handling the platform-specific
work for your program.

First: assembly language code has to go. Replace it with C. You can even use
[x86 SIMD intrinsic functions in Emscripten](https://emscripten.org/docs/porting/simd.html)!

Second: Middleware has to go. If you have a third-party library you link
against, you either need an Emscripten port of it, or the source code to it
to compile yourself, or you need to remove it.

Third: If your program starts in a function called main(), you need to get
out of it and into a function that gets called repeatedly, and returns quickly,
called a mainloop.

Somewhere in your program, you probably have something that looks like a more
complicated version of this:

```c
void main(void)
{
    initialize_the_game();
    while (game_is_still_running) {
        check_for_new_input();
        think_about_stuff();
        draw_the_next_frame();
    }
    deinitialize_the_game();
}
```

This will not work on Emscripten, because the main thread needs to be free
to do stuff and can't sit in this loop forever. So Emscripten lets you set up
a [mainloop](https://emscripten.org/docs/porting/emscripten-runtime-environment.html#browser-main-loop).

```c
static void mainloop(void)   /* this will run often, possibly at the monitor's refresh rate */
{
    if (!game_is_still_running) {
        deinitialize_the_game();
        #ifdef __EMSCRIPTEN__
        emscripten_cancel_main_loop();  /* this should "kill" the app. */
        #else
        exit(0);
        #endif
    }

    check_for_new_input();
    think_about_stuff();
    draw_the_next_frame();
}

void main(void)
{
    initialize_the_game();
    #ifdef __EMSCRIPTEN__
    emscripten_set_main_loop(mainloop, 0, 1);
    #else
    while (1) { mainloop(); }
    #endif
}
```

Basically, `emscripten_set_main_loop(mainloop, 0, 1);` says "run
`mainloop` over and over until I end the program." The function will
run, and return, freeing the main thread for other tasks, and then
run again when it's time. The `1` parameter does some magic to make
your main() function end immediately; this is useful because you
don't want any shutdown code that might be sitting below this code
to actually run if main() were to continue on, since we're just
getting started.

Another option is to use SDL' main callbacks, which handle this for you
without platform-specific code in your app. Please refer to
[the wiki](https://wiki.libsdl.org/SDL3/README/main-functions#main-callbacks-in-sdl3)
or `docs/README-main-functions.md` in the SDL source code.



There's a lot of little details that are beyond the scope of this
document, but that's the biggest initial set of hurdles to porting
your app to the web.


## Do you need threads?

If you plan to use threads, they work on all major browsers now. HOWEVER,
they bring with them a lot of careful considerations. Rendering _must_
be done on the main thread. This is a general guideline for many
platforms, but a hard requirement on the web.

Many other things also must happen on the main thread; often times SDL
and Emscripten make efforts to "proxy" work to the main thread that
must be there, but you have to be careful (and read more detailed
documentation than this for the finer points).

Even when using threads, your main thread needs to set an Emscripten
mainloop (or use SDL's main callbacks) that runs quickly and returns, or
things will fail to work correctly.

You should definitely read [Emscripten's pthreads docs](https://emscripten.org/docs/porting/pthreads.html)
for all the finer points. Mostly SDL's thread API will work as expected,
but is built on pthreads, so it shares the same little incompatibilities
that are documented there, such as where you can use a mutex, and when
a thread will start running, etc.


IMPORTANT: You have to decide to either build something that uses
threads or something that doesn't; you can't have one build
that works everywhere. This is an Emscripten (or maybe WebAssembly?
Or just web browsers in general?) limitation. If you aren't using
threads, it's easier to not enable them at all, at build time.

If you use threads, you _have to_ run from a web server that has
[COOP/COEP headers set correctly](https://web.dev/why-coop-coep/)
or your program will fail to start at all.

If building with threads, `__EMSCRIPTEN_PTHREADS__` will be defined
for checking with the C preprocessor, so you can build something
different depending on what sort of build you're compiling.


## Audio

Audio works as expected at the API level, but not exactly like other
platforms.

You'll only see a single default audio device. Audio recording also works;
if the browser pops up a prompt to ask for permission to access the
microphone, the SDL_OpenAudioDevice call will succeed and start producing
silence at a regular interval. Once the user approves the request, real
audio data will flow. If the user denies it, the app is not informed and
will just continue to receive silence.

Modern web browsers will not permit web pages to produce sound before the
user has interacted with them (clicked or tapped on them, usually); this is
for several reasons, not the least of which being that no one likes when a
random browser tab suddenly starts making noise and the user has to scramble
to figure out which and silence it.

SDL will allow you to open the audio device for playback in this
circumstance, and your audio callback will fire, but SDL will throw the audio
data away until the user interacts with the page. This helps apps that depend
on the audio callback to make progress, and also keeps audio playback in sync
once the app is finally allowed to make noise.

There are two reasonable ways to deal with the silence at the app level:
if you are writing some sort of media player thing, where the user expects
there to be a volume control when you mouseover the canvas, just defa
... (truncated due to size)

================================ Human Message =================================


The commands you have run:```
apt-get update && apt-get install -y build-essential cmake, apt-get install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev, apt-get install -y libgtest-dev libgmock-dev, mkdir -p build && cd build && cmake .. && make -j$(nproc), make test, ctest, cmake -DSDL_TESTS=ON .. && make -j$(nproc)```
Following are the last 5 messages:

================================ Human Message =================================

Observation:
make test
make: *** No rule to make target 'test'.  Stop.


root@ff94e72e4c3d:/testbed/build $

exit code: 2

================================== Ai Message ==================================

Thought: Since 'make test' didn't work, I should check if tests were built and how to run them. Looking at the CMake configuration, tests might be available through ctest.

Action: <command>ctest</command>
================================ Human Message =================================

Observation:
ctest
*********************************
No test configuration file found!
*********************************
Usage

  ctest [options]



root@ff94e72e4c3d:/testbed/build $

exit code: 0

================================== Ai Message ==================================

Thought: The tests don't seem to be configured properly. I should check the CMake configuration to ensure tests were enabled during the build process. Looking back at the CMake output, I need to verify if test targets were included.

Action: <command>cmake -DSDL_TESTS=ON .. && make -j$(nproc)</command>
================================ Human Message =================================

Observation:
cmake -DSDL_TESTS=ON .. && make -j$(nproc)
-- dynamic libasound -> libasound.so.2
-- Checking for module 'jack'
--   No package 'jack' found
-- Checking for module 'libpipewire-0.3>=0.3.44'
--   No package 'libpipewire-0.3' found
-- Checking for module 'libpulse>=0.9.15'
--   Found libpulse, version 15.99.1
-- dynamic libpulse -> libpulse.so.0
-- Checking for module 'sndio'
--   Found sndio, version 1.8.0
-- dynamic libsndio -> libsndio.so.7
-- dynamic libX11 -> libX11.so.6
-- dynamic libXext -> libXext.so.6
-- dynamic libXcursor -> libXcursor.so.1
-- dynamic libXi -> libXi.so.6
-- dynamic libXfixes -> libXfixes.so.3
-- dynamic libXrandr -> libXrandr.so.2
-- dynamic libXrender -> libXrender.so.1
-- dynamic libXss -> libXss.so.1
-- Checking for module 'libdrm'
--   Found libdrm, version 2.4.113
-- Checking for module 'gbm'
--   Found gbm, version 23.2.1-1ubuntu3.1~22.04.3
-- dynamic libdrm -> libdrm.so.2
-- dynamic libgbm -> libgbm.so.1
-- Checking for modules 'wayland-client>=1.18;wayland-egl;wayland-cursor;egl;xkbcommon>=0.5.0'
--   Found wayland-client, version 1.20.0
--   Found wayland-egl, version 18.1.0
--   Found wayland-cursor, version 1.20.0
--   Found egl, version 1.5
--   Found xkbcommon, version 1.4.0
-- dynamic libwayland-client -> libwayland-client.so.0
-- dynamic libwayland-egl -> libwayland-egl.so.1
-- dynamic libwayland-cursor -> libwayland-cursor.so.0
-- dynamic libxkbcommon -> libxkbcommon.so.0
-- dynamic libdecor-0 -> libdecor-0.so.0
-- dynamic libudev -> libudev.so.1
-- Checking for one of the modules 'liburing-ffi'
-- Checking for modules 'libunwind;libunwind-generic'
--   No package 'libunwind' found
--   No package 'libunwind-generic' found
-- Checking for module 'libusb-1.0>=1.0.16'
--   No package 'libusb-1.0' found
-- Could NOT find LibUSB (missing: LibUSB_LIBRARY LibUSB_INCLUDE_PATH) (found version "LibUSB_VERSION-NOTFOUND")
-- Found Python3: /usr/bin/python3.10 (found version "3.10.12") found components: Interpreter 
-- Could NOT find FFmpeg (missing: FFmpeg_AVCODEC_INCLUDE_DIRS FFmpeg_AVCODEC_LIBRARY FFmpeg_AVFORMAT_INCLUDE_DIRS FFmpeg_AVFORMAT_LIBRARY FFmpeg_AVUTIL_INCLUDE_DIRS FFmpeg_AVUTIL_LIBRARY FFmpeg_SWSCALE_INCLUDE_DIRS FFmpeg_SWSCALE_LIBRARY) 
-- Can't find ffmpeg 5.1.3 or newer, skipping testffmpeg
-- Looking for GLES2/gl2platform.h
-- Looking for GLES2/gl2platform.h - found
-- Performing Test HAVE_WFORMAT_OVERFLOW
-- Performing Test HAVE_WFORMAT_OVERFLOW - Success
-- Performing Test HAVE_WFORMAT
-- Performing Test HAVE_WFORMAT - Success
-- Performing Test HAVE_WFORMAT_EXTRA_ARGS
-- Performing Test HAVE_WFORMAT_EXTRA_ARGS - Success
-- 
-- SDL3 was configured with the following options:
-- 
-- Platform: Linux-6.6.87.1-microsoft-standard-WSL2
-- 64-bit:   TRUE
-- Compiler: /usr/bin/cc
-- Revision: SDL3-3.1.9-preview-3.1.8-95-gf731741ea
-- Vendor:   
-- 
-- Subsystems:
--   Audio:    ON
--   Video:    ON
--   GPU:      ON
--   Render:   ON
--   Camera:   ON
--   Joystick: ON
--   Haptic:   ON
--   Hidapi:   ON
--   Power:    ON
--   Sensor:   ON
--   Dialog:   ON
-- 
-- Options:
--   SDL_ALSA                    (Wanted: ON): ON
--   SDL_ALSA_SHARED             (Wanted: ON): ON
--   SDL_ALTIVEC                 (Wanted: OFF): OFF
--   SDL_ARMNEON                 (Wanted: OFF): OFF
--   SDL_ASAN                    (Wanted: OFF): OFF
--   SDL_ASSEMBLY                (Wanted: ON): ON
--   SDL_ASSERTIONS              (Wanted: auto): auto
--   SDL_AVX                     (Wanted: ON): ON
--   SDL_AVX2                    (Wanted: ON): ON
--   SDL_AVX512F                 (Wanted: ON): ON
--   SDL_BACKGROUNDING_SIGNAL    (Wanted: OFF): OFF
--   SDL_CCACHE                  (Wanted: OFF): OFF
--   SDL_CLANG_TIDY              (Wanted: OFF): OFF
--   SDL_CLOCK_GETTIME           (Wanted: ON): ON
--   SDL_COCOA                   (Wanted: OFF): OFF
--   SDL_DBUS                    (Wanted: ON): ON
--   SDL_DIRECTX                 (Wanted: OFF): OFF
--   SDL_DISKAUDIO               (Wanted: ON): ON
--   SDL_DUMMYAUDIO              (Wanted: ON): ON
--   SDL_DUMMYCAMERA             (Wanted: ON): ON
--   S....stripped due to length....
sem
[ 87%] Building C object test/CMakeFiles/testviewport.dir/testviewport.c.o
[ 87%] Built target testime
[ 88%] Building C object test/CMakeFiles/testwm.dir/testwm.c.o
[ 88%] Building C object test/CMakeFiles/testyuv.dir/testyuv.c.o
[ 88%] Linking C executable testurl
[ 88%] Built target testspriteminimal
[ 88%] Linking C executable testver
[ 88%] Built target testspritesurface
[ 88%] Linking C executable testshader
[ 88%] Building C object test/CMakeFiles/testyuv.dir/testyuv_cvt.c.o
[ 88%] Built target teststreaming
[ 88%] Building C object test/CMakeFiles/torturethread.dir/torturethread.c.o
[ 88%] Linking C executable testsprite
[ 88%] Linking C executable testtimer
[ 88%] Building C object test/CMakeFiles/testrendercopyex.dir/testrendercopyex.c.o
[ 88%] Building C object test/CMakeFiles/testmessage.dir/testmessage.c.o
[ 88%] Building C object test/CMakeFiles/testdisplayinfo.dir/testdisplayinfo.c.o
[ 88%] Built target testver
[ 88%] Built target testurl
[ 88%] Built target testsprite
[ 88%] Built target testshader
[ 89%] Building C object test/CMakeFiles/testqsort.dir/testqsort.c.o
[ 89%] Linking C executable testclipboard
[ 89%] Building C object test/CMakeFiles/testbounds.dir/testbounds.c.o
[ 89%] Building C object test/CMakeFiles/testvulkan.dir/testvulkan.c.o
[ 89%] Built target testtimer
[ 90%] Linking C executable testviewport
[ 91%] Linking C executable torturethread
[ 91%] Building C object test/CMakeFiles/testcustomcursor.dir/testcustomcursor.c.o
[ 91%] Building C object test/CMakeFiles/testoffscreen.dir/testoffscreen.c.o
[ 92%] Linking C executable testcamera
[ 92%] Linking C executable testwm
[ 92%] Linking C executable testrendercopyex
[ 93%] Building C object test/CMakeFiles/testpopup.dir/testpopup.c.o
[ 93%] Built target testclipboard
[ 93%] Linking C executable testmessage
[ 93%] Linking C executable testdisplayinfo
[ 93%] Linking C executable testcontroller
[ 93%] Built target torturethread
[ 93%] Built target testviewport
[ 93%] Building C object test/CMakeFiles/testdialog.dir/testdialog.c.o
[ 93%] Linking C executable testbounds
[ 93%] Built target testcamera
[ 93%] Building C object test/CMakeFiles/testtime.dir/testtime.c.o
[ 93%] Built target testrendercopyex
[ 93%] Building C object test/CMakeFiles/testmanymouse.dir/testmanymouse.c.o
[ 94%] Building C object test/CMakeFiles/testmodal.dir/testmodal.c.o
[ 94%] Linking C executable testqsort
[ 94%] Building C object test/CMakeFiles/childprocess.dir/childprocess.c.o
[ 94%] Built target testmessage
[ 94%] Building C object test/CMakeFiles/testtray.dir/testtray.c.o
[ 94%] Built target testwm
[ 94%] Built target testdisplayinfo
[ 94%] Building C object test/CMakeFiles/testwaylandcustom.dir/__/wayland-generated-protocols/xdg-shell-protocol.c.o
[ 94%] Building C object test/CMakeFiles/testwaylandcustom.dir/testwaylandcustom.c.o
[ 97%] Built target testcontroller
[ 97%] Built target testbounds
[ 97%] Linking C executable testpopup
[ 98%] Linking C executable testcustomcursor
[ 99%] Linking C executable testoffscreen
[ 99%] Built target testqsort
[ 99%] Linking C executable testdialog
[ 99%] Linking C executable testautomation
[ 99%] Linking C executable testyuv
[ 99%] Linking C executable testtime
[ 99%] Linking C executable testmodal
[ 99%] Built target testcustomcursor
[ 99%] Built target testpopup
[ 99%] Built target testoffscreen
[ 99%] Built target testdialog
[ 99%] Linking C executable childprocess
[ 99%] Built target testtime
[100%] Linking C executable testtray
[100%] Built target testautomation
[100%] Built target testyuv
[100%] Built target testmodal
[100%] Linking C executable testmanymouse
[100%] Linking C executable testwaylandcustom
[100%] Built target childprocess
[100%] Built target testtray
[100%] Built target testwaylandcustom
[100%] Building C object test/CMakeFiles/testprocess.dir/testprocess.c.o
[100%] Built target testmanymouse
[100%] Linking C executable testvulkan
[100%] Built target testvulkan
[100%] Linking C executable testprocess
[100%] Built target testprocess
[100%] Linking C executable testshape
[100%] Built target testshape


root@ff94e72e4c3d:/testbed/build $

exit code: 0

##### LLM OUTPUT #####
================================== Ai Message ==================================

Thought: The tests were successfully built. Now I should be able to run them using ctest.

Action: <command>cd build && ctest</command>